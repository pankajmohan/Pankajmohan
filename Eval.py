# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'E.ui'
#
# Created by: PyQt5 UI code generator 5.15.1
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
import sqlite3

fcdb = sqlite3.connect('fantasycricket.db')
cursorfc = fcdb.cursor()
# fetching all the teams from database

# fetching all the match table names in database
cursorfc.execute("SELECT name FROM sqlite_master WHERE type='table' AND name LIKE '%match%';")
tup = (cursorfc.fetchall())
recordsmatch = [item for t in tup for item in t]

class Ui_DialogEval(object):
    def setupUi(self, Dialog):
        Dialog.setObjectName("Dialog")
        Dialog.resize(600, 800)
        self.verticalLayout_2 = QtWidgets.QVBoxLayout(Dialog)
        self.verticalLayout_2.setObjectName("verticalLayout_2")
        self.frameEvaluate = QtWidgets.QFrame(Dialog)
        self.frameEvaluate.setFrameShape(QtWidgets.QFrame.NoFrame)
        self.frameEvaluate.setFrameShadow(QtWidgets.QFrame.Plain)
        self.frameEvaluate.setObjectName("frameEvaluate")
        self.verticalLayout = QtWidgets.QVBoxLayout(self.frameEvaluate)
        self.verticalLayout.setObjectName("verticalLayout")
        self.labelEvaluate = QtWidgets.QLabel(self.frameEvaluate)
        self.labelEvaluate.setStyleSheet("font: 9pt \"Comic Sans MS\";")
        self.labelEvaluate.setAlignment(QtCore.Qt.AlignCenter)
        self.labelEvaluate.setObjectName("labelEvaluate")
        self.verticalLayout.addWidget(self.labelEvaluate)
        self.widget = QtWidgets.QWidget(self.frameEvaluate)
        self.widget.setObjectName("widget")
        self.gridLayout_5 = QtWidgets.QGridLayout(self.widget)
        self.gridLayout_5.setObjectName("gridLayout_5")
        spacerItem = QtWidgets.QSpacerItem(40, 20, QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Minimum)
        self.gridLayout_5.addItem(spacerItem, 0, 1, 1, 1)
        self.comboBoxteam = QtWidgets.QComboBox(self.widget)
        self.comboBoxteam.setEnabled(True)
        self.comboBoxteam.setStyleSheet("font: 9pt \"Comic Sans MS\";\n"
"color: rgb(0, 0, 0);\n"
"background-color: rgb(255, 255, 255);\n"
"selection-background-color: blue;")
        self.comboBoxteam.setEditable(False)
        self.comboBoxteam.setObjectName("comboBoxteam")
        cursorfc.execute("SELECT DISTINCT team from teams; ")
        tup = cursorfc.fetchall()
        records = [item for t in tup for item in t]
        self.comboBoxteam.addItem("Select Team")
        self.comboBoxteam.addItems(records)
        self.comboBoxteam.currentIndexChanged.connect(self.addplayers)

        self.gridLayout_5.addWidget(self.comboBoxteam, 0, 0, 1, 1)
        self.comboBoxmatch = QtWidgets.QComboBox(self.widget)
        self.comboBoxmatch.setStyleSheet("font: 9pt \"Comic Sans MS\";\n"
"color: rgb(0, 0, 0);\n"
"background-color: rgb(255, 255, 255);\n"
"selection-background-color: blue;")
        self.comboBoxmatch.setObjectName("comboBoxmatch")
        self.comboBoxmatch.addItem("Select Match")
        self.comboBoxmatch.addItems(recordsmatch)
        self.comboBoxmatch.currentIndexChanged.connect(self.playerpoints)
        self.gridLayout_5.addWidget(self.comboBoxmatch, 0, 2, 1, 1)
        self.verticalLayout.addWidget(self.widget)
        self.line = QtWidgets.QFrame(self.frameEvaluate)
        self.line.setFrameShadow(QtWidgets.QFrame.Plain)
        self.line.setFrameShape(QtWidgets.QFrame.HLine)
        self.line.setObjectName("line")
        self.verticalLayout.addWidget(self.line)
        self.verticalLayout_2.addWidget(self.frameEvaluate)
        self.horizontalLayout_3 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_3.setObjectName("horizontalLayout_3")
        self.widgetPlayers = QtWidgets.QWidget(Dialog)
        self.widgetPlayers.setObjectName("widgetPlayers")
        self.verticalLayout_3 = QtWidgets.QVBoxLayout(self.widgetPlayers)
        self.verticalLayout_3.setObjectName("verticalLayout_3")
        self.labelTeamPlayer = QtWidgets.QLabel(self.widgetPlayers)
        font = QtGui.QFont()
        font.setFamily("Comic Sans MS")
        font.setBold(True)
        font.setWeight(75)
        self.labelTeamPlayer.setFont(font)
        self.labelTeamPlayer.setObjectName("labelTeamPlayer")
        self.verticalLayout_3.addWidget(self.labelTeamPlayer)
        self.listTeamPlayer = QtWidgets.QListWidget(self.widgetPlayers)
        self.listTeamPlayer.setStyleSheet("font: 9pt \"Comic Sans MS\";\n"
"background-color: rgb(255, 255, 255);")
        self.listTeamPlayer.setObjectName("listTeamPlayer")
        self.verticalLayout_3.addWidget(self.listTeamPlayer)
        self.horizontalLayout_3.addWidget(self.widgetPlayers)
        self.widgetPoints = QtWidgets.QWidget(Dialog)
        self.widgetPoints.setObjectName("widgetPoints")
        self.gridLayout_6 = QtWidgets.QGridLayout(self.widgetPoints)
        self.gridLayout_6.setObjectName("gridLayout_6")
        self.labelPlayerPoints = QtWidgets.QLabel(self.widgetPoints)
        font = QtGui.QFont()
        font.setFamily("Comic Sans MS")
        font.setBold(True)
        font.setWeight(75)
        self.labelPlayerPoints.setFont(font)
        self.labelPlayerPoints.setObjectName("labelPlayerPoints")
        self.gridLayout_6.addWidget(self.labelPlayerPoints, 0, 0, 1, 1)
        self.LabelPoints = QtWidgets.QLabel(self.widgetPoints)
        font = QtGui.QFont()
        font.setFamily("Comic Sans MS")
        self.LabelPoints.setFont(font)
        self.LabelPoints.setObjectName("LabelPoints")
        # self.LabelPoints.setStyleSheet("font: 75 9pt \"Comic Sans MS\";\n""color: rgb(51, 236, 255);)")
        self.LabelPoints.setStyleSheet("color: rgb(51, 236, 255);""font:  9pt \"Comic Sans MS\";\n")
        self.gridLayout_6.addWidget(self.LabelPoints, 0, 1, 1, 1)
        self.listPlayerPoints = QtWidgets.QListWidget(self.widgetPoints)
        self.listPlayerPoints.setStyleSheet("font: 9pt \"Comic Sans MS\";\n"
"background-color: rgb(255, 255, 255);")
        self.listPlayerPoints.setObjectName("listPlayerPoints")
        self.gridLayout_6.addWidget(self.listPlayerPoints, 1, 0, 1, 2)
        self.horizontalLayout_3.addWidget(self.widgetPoints)
        self.verticalLayout_2.addLayout(self.horizontalLayout_3)
        self.horizontalLayout_4 = QtWidgets.QHBoxLayout()
        self.horizontalLayout_4.setObjectName("horizontalLayout_4")
        spacerItem1 = QtWidgets.QSpacerItem(40, 20, QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Minimum)
        self.horizontalLayout_4.addItem(spacerItem1)
        self.btnCalScore = QtWidgets.QPushButton(Dialog)
        font = QtGui.QFont()
        font.setFamily("Comic Sans MS")
        font.setPointSize(8)
        font.setBold(False)
        font.setItalic(False)
        font.setWeight(50)
        self.btnCalScore.setFont(font)
        self.btnCalScore.setStyleSheet("font: 8pt \"Comic Sans MS\";")
        self.btnCalScore.setObjectName("btnCalScore")
        self.horizontalLayout_4.addWidget(self.btnCalScore)
        spacerItem2 = QtWidgets.QSpacerItem(40, 20, QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Minimum)
        self.horizontalLayout_4.addItem(spacerItem2)
        self.verticalLayout_2.addLayout(self.horizontalLayout_4)

        self.retranslateUi(Dialog)
        QtCore.QMetaObject.connectSlotsByName(Dialog)

    def retranslateUi(self, Dialog):
        _translate = QtCore.QCoreApplication.translate
        Dialog.setWindowTitle(_translate("Dialog", "Evaluate Team"))
        self.labelEvaluate.setText(_translate("Dialog", "Evaluate the Performance of your Fantasy Team"))
        self.comboBoxteam.setCurrentText(_translate("Dialog", "Select Team"))
        self.comboBoxteam.setPlaceholderText(_translate("Dialog", "Select Team"))
        self.comboBoxmatch.setCurrentText(_translate("Dialog", "Select Match"))
        self.comboBoxmatch.setPlaceholderText(_translate("Dialog", "Select Match"))
        self.labelTeamPlayer.setText(_translate("Dialog", "Players"))
        self.labelPlayerPoints.setText(_translate("Dialog", "Points"))
        self.LabelPoints.setText(_translate("Dialog", "0.0"))
        self.btnCalScore.setText(_translate("Dialog", "Calculate Score"))
        self.btnCalScore.clicked.connect(self.calculatetotal)

    def calculatetotal(self):
        total = 0.0
        for p in range(self.listPlayerPoints.count()):
            total += float(self.listPlayerPoints.item(p).text())
        self.LabelPoints.setText(str(total))

    def addplayers(self):
        self.listTeamPlayer.clear()
        teamname = self.comboBoxteam.currentText()
        cursorfc.execute("SELECT name  FROM teams WHERE team ='" + teamname + "'  ")
        tup = cursorfc.fetchall()
        records = [item for t in tup for item in t]
        self.listTeamPlayer.addItems(records)


    def playerpoints(self):
        self.listPlayerPoints.clear()
        self.LabelPoints.setText('0.0')
        listpoints = []
        for p in range(self.listTeamPlayer.count()):
            player = self.listTeamPlayer.item(p).text()
            match = self.comboBoxmatch.currentText()
            cursorfc.execute("SELECT scored FROM '" + match + "' WHERE player='" + player + "';")
            runs = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT fours FROM '" + match + "' WHERE player='" + player + "';")
            fours = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT sixes FROM '" + match + "' WHERE player='" + player + "';")
            sixes = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT faced FROM '" + match + "' WHERE player='" + player + "';")
            balls = int(''.join(map(str, cursorfc.fetchone())))
            overs = int(balls)/6
            cursorfc.execute("SELECT wkts FROM '" + match + "' WHERE player='" + player + "';")
            wkts = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT stumping FROM '" + match + "' WHERE player='" + player + "';")
            stumping = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT runout FROM '" + match + "' WHERE player='" + player + "';")
            runout = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT catches FROM '" + match + "' WHERE player='" + player + "';")
            catches = int(''.join(map(str, cursorfc.fetchone())))
            # cursorfc.execute("SELECT Bowled FROM '" + match + "' WHERE player='" + player + "';")
            # bowled = int(''.join(map(str, cursorfc.fetchone())))
            cursorfc.execute("SELECT given FROM '" + match + "' WHERE player='" + player + "';")
            given = int(''.join(map(str, cursorfc.fetchone())))
            # cursorfc.execute("SELECT maiden FROM '" + match + "' WHERE player='" + player + "';")
            # maiden = int(''.join(map(str, cursorfc.fetchone())))
            pointsfield = int(runout) + int(catches) + int(stumping)
            strikerate = 0.0
            pointsbat = 0
            if balls == 0:
                strikerate = None
            else:
                strikerate = float(runs/balls) * 100
                if 80.0 <= strikerate <= 100.0:
                    pointsbat += 2

                if strikerate > 100:
                    pointsbat += 4



            pointsbowl = 0
            pointsbat += (runs/2) + (fours*1) + (sixes*2)

            if runs >= 50:
                pointsbat += 5

            if runs >= 100:
                pointsbat += 10


            pointsbowl += (wkts*10)

            if overs == 0:
                ecorate = None
            else:
                ecorate = float(given/overs)
                if 3.5 <= ecorate <= 4.5:
                    pointsbowl += 4

                if 2 <= ecorate < 3.5:
                    pointsbowl += 7

                if ecorate < 2:
                    pointsbowl += 10

            if wkts >=3:
                pointsbowl += 5

            if wkts >=5:
                pointsbowl += 10

            points = pointsbat + pointsfield + pointsbowl


            listpoints.append(str(points))
        self.listPlayerPoints.addItems(listpoints)












if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    Dialog = QtWidgets.QDialog()
    ui = Ui_DialogEval()
    ui.setupUi(Dialog)
    Dialog.show()
    sys.exit(app.exec_())
